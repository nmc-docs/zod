"use strict";(self.webpackChunkreactjs=self.webpackChunkreactjs||[]).push([[536],{6408:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>c,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"custom-validation","title":"Custom validation","description":".refine()","source":"@site/docs/custom-validation.md","sourceDirName":".","slug":"/custom-validation","permalink":"/zod/custom-validation","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"Transform","permalink":"/zod/transform"},"next":{"title":"Custom errors","permalink":"/zod/custom-errors"}}');var t=s(4848),i=s(8453);const c={sidebar_position:4},o="Custom validation",a={},l=[{value:"<code>.refine()</code>",id:"refine",level:2},{value:"<code>error</code>",id:"error",level:3},{value:"<code>path</code>",id:"path",level:3},{value:"<code>abort</code>",id:"abort",level:3},{value:"asynchronous refinement",id:"asynchronous-refinement",level:3},{value:"<code>.superRefine()</code>",id:"superrefine",level:2}];function d(n){const e={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",pre:"pre",ul:"ul",...(0,i.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.header,{children:(0,t.jsx)(e.h1,{id:"custom-validation",children:"Custom validation"})}),"\n",(0,t.jsx)(e.h2,{id:"refine",children:(0,t.jsx)(e.code,{children:".refine()"})}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["Ta c\xf3 th\u1ec3 custom validation b\u1eb1ng ph\u01b0\u01a1ng th\u1ee9c ",(0,t.jsx)(e.code,{children:".refine()"}),":"]}),"\n"]}),"\n",(0,t.jsx)(e.admonition,{type:"info",children:(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["Ph\u01b0\u01a1ng th\u1ee9c ",(0,t.jsx)(e.code,{children:"refine()"})," nh\u1eadn v\xe0o m\u1ed9t callback"]}),"\n",(0,t.jsxs)(e.li,{children:["H\xe0m callback ph\u1ea3i tr\u1ea3 v\u1ec1 ",(0,t.jsx)(e.code,{children:"true"})," ho\u1eb7c ",(0,t.jsx)(e.code,{children:"false"})]}),"\n",(0,t.jsxs)(e.li,{children:["N\u1ebfu h\xe0m callback tr\u1ea3 v\u1ec1 ",(0,t.jsx)(e.code,{children:"false"}),", th\xec t\u1ee9c l\xe0 c\xf3 l\u1ed7i"]}),"\n"]})}),"\n",(0,t.jsx)(e.h3,{id:"error",children:(0,t.jsx)(e.code,{children:"error"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-ts",children:'const myString = z.string().refine((val) => val.length <= 255, {\n  error: "String can\'t be more than 255 characters",\n});\n'})}),"\n",(0,t.jsx)(e.h3,{id:"path",children:(0,t.jsx)(e.code,{children:"path"})}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Validate gi\u1eefa c\xe1c tr\u01b0\u1eddng ph\u1ee5 thu\u1ed9c nhau trong object:"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-ts",children:'const passwordForm = z\n  .object({\n    password: z.string(),\n    confirm: z.string(),\n  })\n  .refine((data) => data.password === data.confirm, {\n    message: "Passwords don\'t match",\n    path: ["confirm"], // path of error\n  });\n'})}),"\n",(0,t.jsx)(e.h3,{id:"abort",children:(0,t.jsx)(e.code,{children:"abort"})}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Theo m\u1eb7c \u0111\u1ecbnh, c\xe1c v\u1ea5n \u0111\u1ec1 x\xe1c th\u1ef1c t\u1eeb c\xe1c l\u1ea7n ki\u1ec3m tra \u0111\u01b0\u1ee3c coi l\xe0 li\xean t\u1ee5c; ngh\u0129a l\xe0 Zod s\u1ebd th\u1ef1c hi\u1ec7n t\u1ea5t c\u1ea3 c\xe1c l\u1ea7n ki\u1ec3m tra theo tr\xecnh t\u1ef1, ngay c\u1ea3 khi m\u1ed9t trong s\u1ed1 ch\xfang g\xe2y ra l\u1ed7i x\xe1c th\u1ef1c. \u0110i\u1ec1u n\xe0y th\u01b0\u1eddng \u0111\u01b0\u1ee3c mong mu\u1ed1n, v\xec n\xf3 c\xf3 ngh\u0129a l\xe0 Zod c\xf3 th\u1ec3 ph\xe1t hi\u1ec7n c\xe0ng nhi\u1ec1u l\u1ed7i c\xe0ng t\u1ed1t ch\u1ec9 trong m\u1ed9t l\u1ea7n."}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-ts",children:'const myString = z\n  .string()\n  .refine((val) => val.length > 8, { error: "Too short!" })\n  .refine((val) => val === val.toLowerCase(), { error: "Must be lowercase" });\n\nconst result = myString.safeParse("OH NO");\nresult.error?.issues;\n/* [\n  { "code": "custom", "message": "Too short!" },\n  { "code": "custom", "message": "Must be lowercase" }\n] */\n'})}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"\u0110\u1ec3 vi\u1ec7c validate ch\u1ea5m d\u1ee9t ngay l\u1eadp t\u1ee9c n\u1ebfu fail, ta s\u1eed d\u1ee5ng:"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-ts",children:'const myString = z\n  .string()\n  .refine((val) => val.length > 8, { error: "Too short!", abort: true })\n  .refine((val) => val === val.toLowerCase(), {\n    error: "Must be lowercase",\n    abort: true,\n  });\n\nconst result = myString.safeParse("OH NO");\nresult.error?.issues;\n// => [{ "code": "custom", "message": "Too short!" }]\n'})}),"\n",(0,t.jsx)(e.h3,{id:"asynchronous-refinement",children:"asynchronous refinement"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Ta c\xf3 th\u1ec3 s\u1eed d\u1ee5ng asynchronous refinement:"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-ts",children:"const userId = z.string().refine(async (id) => {\n  // verify that ID exists in database\n  return true;\n});\n"})}),"\n",(0,t.jsxs)(e.admonition,{title:"Ch\xfa \xfd",type:"note",children:[(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["N\u1ebfu s\u1eed d\u1ee5ng h\xe0m async trong refine, ta ph\u1ea3i s\u1eed d\u1ee5ng ",(0,t.jsx)(e.code,{children:".parseAsync"})," \u0111\u1ec3 parse d\u1eef li\u1ec7u. N\u1ebfu kh\xf4ng, Zod s\u1ebd throw ra l\u1ed7i:"]}),"\n"]}),(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-ts",children:'const result = await userId.parseAsync("abc123");\n'})})]}),"\n",(0,t.jsx)(e.h2,{id:"superrefine",children:(0,t.jsx)(e.code,{children:".superRefine()"})}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["N\u1ebfu mu\u1ed1n custom nhi\u1ec1u validation th\xec ta ph\u1ea3i th\u1ef1c hi\u1ec7n ",(0,t.jsx)(e.code,{children:".refine()"})," nhi\u1ec1u l\u1ea7n. \u0110\u1ec3 tr\xe1nh \u0111i\u1ec1u \u0111\xf3, s\u1eed d\u1ee5ng ",(0,t.jsx)(e.code,{children:".superRefine()"}),":"]}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-ts",children:'const FormValidationSchema = z\n  .object({\n    password: z.string().nonempty("Please enter your password"),\n    confirm: z.string(),\n  })\n  .superRefine(({ password, confirm }, ctx) => {\n    if (password !== confirm) {\n      ctx.addIssue({\n        code: "custom",\n        message: "Password don\'t match",\n        path: ["confirm"],\n      });\n    }\n    if (password.length < 8) {\n      ctx.addIssue({\n        code: "custom",\n        message: "Password is too short",\n        path: ["password"],\n      });\n    }\n  });\n'})}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"V\xed d\u1ee5 kh\xe1c validate array kh\xf4ng c\xf3 c\xe1c ph\u1ea7n t\u1eed tr\xf9ng l\u1eb7p v\xe0 c\xf3 \u0111\u1ed9 d\xe0i kh\xf4ng qu\xe1 3:"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-ts",children:'const UniqueStringArray = z.array(z.string()).superRefine((val, ctx) => {\n  if (val.length > 3) {\n    ctx.addIssue({\n      code: "too_big",\n      maximum: 3,\n      origin: "array",\n      inclusive: true,\n      message: "Too many items \ud83d\ude21",\n      input: val,\n    });\n  }\n\n  if (val.length !== new Set(val).size) {\n    ctx.addIssue({\n      code: "custom",\n      message: `No duplicates allowed.`,\n      input: val,\n    });\n  }\n});\n'})})]})}function h(n={}){const{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(d,{...n})}):d(n)}},8453:(n,e,s)=>{s.d(e,{R:()=>c,x:()=>o});var r=s(6540);const t={},i=r.createContext(t);function c(n){const e=r.useContext(i);return r.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:c(n.components),r.createElement(i.Provider,{value:e},n.children)}}}]);